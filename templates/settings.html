<!DOCTYPE html>
<html><head><meta charset="utf-8"/><title>Encrypted Settings</title>
<style>
body{font-family:system-ui,Arial;background:#f6f7fb;margin:0}
main{max-width:900px;margin:40px auto;background:#fff;padding:24px;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,.06)}
input{padding:10px;border:1px solid #ccc;border-radius:6px;width:100%}
button{padding:10px 14px;border:none;background:#0d6efd;color:#fff;border-radius:6px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:18px}
th,td{border-bottom:1px solid #eee;text-align:left;padding:8px}
.del{background:#dc3545}
.tip{color:#666;font-size:14px}
.grid3{display:grid;grid-template-columns:1fr 2fr auto;gap:8px;align-items:center}
.card{border:1px solid #eee;border-radius:8px;padding:12px;margin:12px 0;background:#fafafa}
</style></head>
<body><main>
<h2>Encrypted Settings</h2>
<p class="tip">Add or rotate provider secrets. Values are encrypted at rest and never displayed.</p>

<div class="card">
  <h3>Add / Update a secret</h3>
  <form method="post" action="/settings/secret">
    <div class="grid3">
      <input name="key" placeholder="FACEBOOK_CLIENT_ID (or API_KEY, CRON_SECRET, etc.)" required/>
      <input name="value" placeholder="value" required/>
      <button type="submit">Save</button>
    </div>
  </form>
  <p class="tip">Common keys: API_KEY, CRON_SECRET, FACEBOOK_CLIENT_ID/SECRET/REDIRECT_URI, INSTAGRAM_REDIRECT_URI, TIKTOK_CLIENT_KEY/SECRET/REDIRECT_URI, GOOGLE_CLIENT_ID/SECRET/REDIRECT_URI.</p>
</div>

<div class="card">
  <h3>Run token refresh now</h3>
  <p class="tip">Refresh Facebook/Instagram (60-day), TikTok and YouTube tokens. Requires <code>CRON_SECRET</code>.</p>
  <button onclick="runRefresh()">Run all</button>
  <button onclick="runRefresh('facebook')">Only Facebook/Instagram</button>
  <button onclick="runRefresh('tiktok')">Only TikTok</button>
  <button onclick="runRefresh('youtube')">Only YouTube</button>
</div>

<table>
  <thead><tr><th>Key</th><th>Created</th><th></th></tr></thead>
  <tbody>
  {% for s in secrets %}
    <tr><td>{{ s.key }}</td><td>{{ s.created_at }}</td><td><button class="del" onclick="delSecret('{{ s.key }}')">Delete</button></td></tr>
  {% else %}<tr><td colspan="3">No secrets saved yet.</td></tr>{% endfor %}
  </tbody>
</table>
<p style="margin-top:14px"><a href="/">‚Üê Back</a></p>
<script>
async function delSecret(key){
  const apiKey = prompt('Enter API Key'); if(!apiKey) return;
  await fetch('/settings/secret/'+encodeURIComponent(key), {method:'DELETE', headers:{'X-API-Key': apiKey}});
  location.reload();
}
async function runRefresh(platform){
  const cron = prompt('Enter CRON_SECRET'); if(!cron) return;
  const url = platform ? '/admin/refresh?platform='+encodeURIComponent(platform) : '/admin/refresh';
  const res = await fetch(url, {method:'POST', headers:{'X-Cron-Secret': cron}});
  const txt = await res.text();
  alert(txt);
}
</script>
</main></body></html>
